!(function (a) {
  a.spapp = function (b) {
    var c,
      d = {};
    (c = a.extend(
      {
        defaultView: a("main#spapp > section:last-child").attr("id"),
        templateDir: "./tpl/",
        pageNotFound: !1,
      },
      b
    )),
      a("main#spapp > section").each(function (b, c) {
        var e = a(this);
        d[e.attr("id")] = {
          view: e.attr("id"),
          load: e.data("load"),
          onCreate: function () {},
          onReady: function () {},
        };
      }),
      (this.route = function (b) {
        a.extend(d[b.view], b);
      });
    var e = function () {
      var hash = location.hash.slice(1);
      if (hash.startsWith("book?isbn=")) {
        var isbn = hash.split("=")[1];
        var bookView = d["book"]; // Assuming you have a view named "book"
        if (bookView) {
          var f = a("#book"); 
          if (f) {
            f.addClass("spapp-created");
            if (bookView.load) {
              f.load(c.templateDir + bookView.load + "?isbn=" + isbn, function () {
                bookView.onCreate();
                bookView.onReady();
              });
            } else {
              bookView.onCreate();
              bookView.onReady();
            }
          } else {
            console.log("Book section not found");
          }
        } else {
          console.log("Book view not defined");
        }
      } else {
        var view = d[hash];
        if (view) {
          var section = a("#" + hash);
          if (section) {
            if (section.hasClass("spapp-created")) {
              view.onReady();
            } else {
              section.addClass("spapp-created");
              if (view.load) {
                section.load(c.templateDir + view.load, function () {
                  view.onCreate();
                  view.onReady();
                });
              } else {
                view.onCreate();
                view.onReady();
              }
            }
          } else {
            console.log(hash + " section not found");
          }
        } else {
          if (c.pageNotFound) {
            window.location.hash = c.pageNotFound;
          } else {
            console.log(hash + " not defined");
          }
        }
      }
    };
    return (
      (this.run = function () {
        window.addEventListener("hashchange", function () {
          e();
        });
        window.location.hash ? e() : (window.location.hash = c.defaultView);
      }),
      this
    );
  };
})(jQuery);
